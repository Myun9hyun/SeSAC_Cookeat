<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>레시피 업로드</title>
        <!-- include libraries(jQuery, bootstrap) -->
        <link
            href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
        <!-- include summernote css/js -->
        <link
            href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css"
            rel="stylesheet"
        />
        <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
        <!-- axios CDN -->
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <br />

        <script>
            $(document).ready(function () {
                $("#summernote").summernote({
                    placeholder: "- 나만의 레시피를 작성해 주세요",
                    tabsize: 2,
                    height: 740,
                });
            });
        </script>
        <script>
            function recipeSummit() {
                var title = $("#title").val();
                var content = $("#summernote").summernote("code"); // 에디터의 내용을 HTML 문자열로 가져옴
                var category = $("#category").val();
                var accessToken = localStorage.getItem("user");

                axios({
                    method: "post",
                    url: "/post",
                    headers: {
                        Authorization: "Bearer " + accessToken,
                        "Content-Type": "application/json",
                    },
                    data: {
                        title: title,
                        content: content,
                        category: category,
                    },
                })
                    .then(function (response) {
                        alert("레시피 등록이 완료되었습니다.");
                        localStorage.setItem("createPostId", response.data.postId); // response에서 postId 가져와서 저장
                        window.location = "/post/" + response.data.postId;
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            }
        </script>
    </head>
    <body>
        <%- include('nav.ejs') %>
        <br />
        <div class="container" style="margin-top: 20px; margin-bottom: 20px">
            <div>
                <div class="form-group">
                    <h2><label for="title">레시피 작성하기</label></h2>
                    <!-- placeholder 속성 입력한 데이터가 없는 경우 배경으로 나타난다.실제적으로 입력을 100자까지로 지정 -->
                    <!-- required 속성을 설정하면 필수입력 사항이된다. -->
                    <!-- pattern 속성을 이용한 정규표현식으로 데이터의 유효성 검사를 할 수 있다. -->
                    <input
                        type="text"
                        class="form-control"
                        id="title"
                        placeholder="나만의 레시피 이름을 작성해주세요."
                        name="title"
                        maxlength="150"
                        required="required"
                        pattern=".{4,150}"
                    />
                </div>
                <div class="form-group">
                    <!--  여러줄의 데이터를 입력하고 하고자 할때 textarea 태그를 사용한다. -->
                    <!--  textarea 안에 있는 모든 글자는 그대로 나타난다. 공백문자, tag, enter -->
                    <textarea
                        class="form-control1"
                        rows="5"
                        id="summernote"
                        name="content"
                        placeholder="내용 작성"
                    ></textarea>
                </div>
                <div class="form-group">
                    <label for="category">Cooking Style</label>
                    <select class="form-control" id="category" name="category">
                        <option selected>카테고리를 선택해주세요.</option>
                        <option value="한식">한식</option>
                        <option value="양식">양식</option>
                        <option value="중식">중식</option>
                        <option value="일식">일식</option>
                        <option value="퓨전">퓨전</option>
                        <option value="베이킹">베이킹</option>
                        <option value="기타">기타</option>
                    </select>
                </div>
                <br />
                <button type="button" class="btn btn-secondary" onclick="recipeSummit()">
                    레시피 등록
                </button>
                <button type="button" class="btn btn-outline-secondary">작성 취소</button>
            </div>
            <br />
            <br />
            <br />
        </div>
        <%- include('footer.ejs') %>
    </body>
</html>
